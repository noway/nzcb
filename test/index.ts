import { expect } from "chai";
import { ethers } from "hardhat";
import { NZCOVIDBadge } from "../typechain";

const a: [bigint, bigint] = [
  4121745176342597789136770973022776790739432511025396054059983293468563743385n, 5487528317701654699472294238975712264208021864345680894679201230717526293867n
]

const b: [[bigint, bigint],[bigint, bigint]] = 
  [[11073023599814217189304591557517845609121126091167894404602868744081798402214n, 8789603760936810492318929603762240484850214444021387445080201431595418948611n], [11418442315355766077534296427282460642855786446073237008164794662509203235107n, 20737180799573811520838532444804591001462475093507592260093850141052562199311n]]

const c: [bigint, bigint] = [1028546350178609515692678068031149437504661244443131952435099557891040235077n, 10879563735156659176541504877990982450500988408022307877598352088723069095847n]

const input: [bigint, bigint, bigint] = [
  8464235439336389695359576364537904521787463454426143836621154307990710930n, 334204042160295982690797293769892102755483197293558786265320143920457223185n, 430989588176825940781496969207245773238692149205558489568811355968561479680n
]


const A = [ "17285857194286030951643413384080770128102555891376275650920632385206886588209", "8146744797527597683612285820739161785613066720976189539337401542346009411025", "1" ]
const B = [ "15682504116274798503014934889003500525027713415048530262804470773169924756544", "16147034893940752680027763009018539429022116647353747304980448414620142532374", "1" ]
const C = [ "12085574453551961734401969337257584932726570462480358679465358620917939959720", "10067483988196768474380294571499252508931711761800186124617952567567149776216", "1" ]
const T1 = [ "9341776045511567742705047838971603534293703828473589813224018950900935709358", "1991419358367301347015760791834569564955086211461334090131250296995947056397", "1" ]
const T2 = [ "15139914011206602215573065149449112119374012195722218343755684376017158290698", "20962019652951085634301364474115330989894673248155900462739025467051618513157", "1" ]
const T3 = [ "16051847535986722328308654216307776777454974101336585083035415812835527494703", "2481762947298090707152429542320583588166801204862240887274669870827553850369", "1" ]
const Wxi = [ "2969543294423175071507798246441250629865870147863651073753451271912936634631", "15467792113195698219865595327163140277104325078439095146927031196510092437254", "1" ]
const Wxiw = [ "15287833335678082990805431028497776140936741124163965407078004429260927474436", "384092082319840676379837130201641207993929791856035480592481747713766812750", "1" ]
const Z = [ "17233356032174959935462299411402444862306272851918465453525840747130034079125", "14330383888858615496931317939370288610560509893872354346781519905233457242924", "1" ]
const curve = "bn128"
const eval_a = "20873124803111981482158637286573548102186240982833174526255697778284927955180"
const eval_b = "14725117969359343640282739098483759411202136774012105531473320282499171717922"
const eval_c = "13522439859327188316271521022912781506058520813094819066815702996397417121410"
const eval_r = "3645660092017650040225974040904310034976842565433931976595237367298016916187"
const eval_s1 = "245581223381763181115398381709173291740991302828802067918080773517942876358"
const eval_s2 = "18283024571994954244371580939691607922437711646043720896247050161012382161604"
const eval_zw = "20841814415782754133466958283685247955238275734380821043703696797913083330243"
const protocol = "plonk"

const inputs = [
"8464235439336389695359576364537904521787463454426143836621154307990710930",
"334204042160295982690797293769892102755483197293558786265320143920457223185",
"430989588176825346791827322625404962104722513508263561834535300537883033600",
]

// const credSubjHash = "0x5fb355822221720ea4ce6734e5a09e459d452574a19310c0cea7c141f43a3dab"

const r = "0xD2E07B1DD7263D833166BDBB4F1A093837A905D7ECA2EE836B6B2ADA23C23154";
const s = "0xFBA88A529F675D6686EE632B09EC581AB08F72B458904BB3396D10FA66D11477";

describe("NZCOVIDBadge only mint", function () {
  let covidBadge: NZCOVIDBadge

  before(async () => {
    const NZCOVIDBadge = await ethers.getContractFactory("NZCOVIDBadge");
    covidBadge = await NZCOVIDBadge.deploy("NZ COVID Badge", "NZCP");
    await covidBadge.deployed();
  })

  it("Should mint", async function () {
    const mintTx = await covidBadge.mint(a, b, c, input, [r, s])
    await mintTx.wait();
  });
});

describe("NZCOVIDBadge check logic", function () {
  let covidBadge: NZCOVIDBadge

  before(async () => {
    const NZCOVIDBadge = await ethers.getContractFactory("NZCOVIDBadge");
    covidBadge = await NZCOVIDBadge.deploy("NZ COVID Badge", "NZCP");
    await covidBadge.deployed();
  })

  it("Should mint", async function () {
    await expect(covidBadge.tokenURI(0)).to.be.revertedWith("URI query for nonexistent token");
    const mintTx = await covidBadge.mint(a, b, c, input, [r, s])
    await mintTx.wait();
    expect(await covidBadge.tokenURI(0)).to.equal("https://i.imgur.com/QYKQsql.jpg");
  });

  it("Should not mint again", async function () {
    expect(await covidBadge.tokenURI(0)).to.equal("https://i.imgur.com/QYKQsql.jpg");
    await expect(covidBadge.mint(a, b, c, input, [r, s])).to.be.revertedWith("Already minted");
  });

  // it("Should show as minted for this cred subj hash", async function () {
  //   expect(await covidBadge.hasMinted(credSubjHash)).to.equal(1);
  // });

  it("Should show the signer as owner for token id 0", async function () {
    expect(await covidBadge.getOwner(0)).to.equal("0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266");
  });
});
